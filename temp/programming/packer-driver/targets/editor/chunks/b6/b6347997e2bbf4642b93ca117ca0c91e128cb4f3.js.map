{"version":3,"sources":["file:///Users/fouryu/Desktop/KylinsEasyController/assets/kylins_easy_controller/FreeCamera.ts"],"names":["_decorator","Component","Quat","Vec2","Vec3","Input","game","input","EventKeyboard","KeyCode","v2","ccclass","property","v2_1","v2_2","v3_1","qt_1","forward","right","FreeCamera","slide","range","_euler","_velocity","_position","_speedScale","_eulerP","keys","moveDir","key2dirMap","onLoad","on","EventType","MOUSE_WHEEL","onMouseWheel","TOUCH_START","onTouchStart","TOUCH_MOVE","onTouchMove","TOUCH_END","onTouchEnd","copy","node","eulerAngles","getPosition","KEY_DOWN","onKeyDown","KEY_UP","onKeyUp","onDestroy","off","update","dt","t","Math","min","damp","transformQuat","rotation","scaleAndAdd","moveSpeed","lerp","setPosition","lengthSqr","FORWARD","normalize","cross","UP","z","x","y","fromEuler","slerp","setWorldRotationFromEuler","e","delta","getScrollY","UNIT_Z","position","canvas","requestPointerLock","getStartLocation","width","getDelta","rotateSpeed","document","exitPointerLock","event","console","log","keyCode","KEY_A","KEY_S","KEY_D","KEY_W","indexOf","push","updateDirection","KEY_Q","KEY_E","index","splice","keyCode0","length","keyCode1","dir"],"mappings":"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","sourcesContent":["import { _decorator, Component, Quat, Vec2, Vec3, Input, game, EventTouch, EventMouse, input, EventKeyboard, KeyCode, v2 } from 'cc';\nconst { ccclass, property } = _decorator;\n\nconst v2_1 = new Vec2();\nconst v2_2 = new Vec2();\nconst v3_1 = new Vec3();\nconst qt_1 = new Quat();\nconst forward = new Vec3();\nconst right = new Vec3();\n\n@ccclass\nexport class FreeCamera extends Component {\n\n    @property\n    public moveSpeed = 1;\n\n    @property\n    public moveSpeedShiftScale = 5;\n\n    @property({ slide: true, range: [0.05, 0.5, 0.01] })\n    public damp = 0.2;\n\n    @property\n    public rotateSpeed = 1;\n\n    private _euler = new Vec3();\n    private _velocity = new Vec3();\n    private _position = new Vec3();\n    private _speedScale = 1;\n    private _eulerP = new Vec3();\n\n    public onLoad () {\n        input.on(Input.EventType.MOUSE_WHEEL, this.onMouseWheel, this);\n        input.on(Input.EventType.TOUCH_START, this.onTouchStart, this);\n        input.on(Input.EventType.TOUCH_MOVE, this.onTouchMove, this);\n        input.on(Input.EventType.TOUCH_END, this.onTouchEnd, this);\n        Vec3.copy(this._euler, this.node.eulerAngles);\n        Vec3.copy(this._position, this.node.getPosition());\n        Vec3.copy(this._eulerP, this.node.eulerAngles);\n\n        input.on(Input.EventType.KEY_DOWN, this.onKeyDown, this);\n        input.on(Input.EventType.KEY_UP, this.onKeyUp, this);\n    }\n\n    public onDestroy () {\n        input.off(Input.EventType.MOUSE_WHEEL, this.onMouseWheel, this);\n        input.off(Input.EventType.TOUCH_START, this.onTouchStart, this);\n        input.off(Input.EventType.TOUCH_MOVE, this.onTouchMove, this);\n        input.off(Input.EventType.TOUCH_END, this.onTouchEnd, this);\n\n        input.off(Input.EventType.KEY_DOWN, this.onKeyDown, this);\n        input.off(Input.EventType.KEY_UP, this.onKeyUp, this);\n    }\n\n\n    public update (dt: number) {\n        const t = Math.min(dt / this.damp, 1);\n        // position\n        Vec3.transformQuat(v3_1, this._velocity, this.node.rotation);\n        Vec3.scaleAndAdd(this._position, this._position, v3_1, this.moveSpeed * this._speedScale);\n        Vec3.lerp(v3_1, this.node.getPosition(), this._position, t);\n        this.node.setPosition(v3_1);\n\n        if(this.moveDir.lengthSqr()){\n            Vec3.transformQuat(forward, Vec3.FORWARD, this.node.rotation);\n            forward.normalize();\n            Vec3.cross(right, forward, Vec3.UP);\n            right.normalize();\n\n            Vec3.scaleAndAdd(this._position, this._position, forward, this.moveSpeed * this._speedScale * this.moveDir.z);\n            Vec3.lerp(v3_1, this.node.getPosition(), this._position, t);\n            this.node.setPosition(v3_1);\n\n            Vec3.scaleAndAdd(this._position, this._position, right, this.moveSpeed * this._speedScale * this.moveDir.x);\n            Vec3.lerp(v3_1, this.node.getPosition(), this._position, t);\n            this.node.setPosition(v3_1);\n\n            Vec3.scaleAndAdd(this._position, this._position, Vec3.UP, this.moveSpeed * this._speedScale * this.moveDir.y);\n            Vec3.lerp(v3_1, this.node.getPosition(), this._position, t);\n            this.node.setPosition(v3_1);\n        }\n\n        // rotation\n        Quat.fromEuler(qt_1, this._eulerP.x, this._eulerP.y, this._eulerP.z);\n        Quat.slerp(qt_1, this.node.rotation, qt_1, t);\n        this.node.setWorldRotationFromEuler(this._eulerP.x, this._eulerP.y, this._eulerP.z);\n    }\n\n    public onMouseWheel (e: EventMouse) {\n        const delta = -e.getScrollY() * this.moveSpeed * 0.1; // delta is positive when scroll down\n        Vec3.transformQuat(v3_1, Vec3.UNIT_Z, this.node.rotation);\n        Vec3.scaleAndAdd(this._position, this.node.position, v3_1, delta);\n    }\n    \n    public onTouchStart (e: EventTouch) {\n        if (game.canvas.requestPointerLock) { game.canvas.requestPointerLock(); }\n    }\n\n    public onTouchMove (e: EventTouch) {\n        e.getStartLocation(v2_1);\n        if (v2_1.x > game.canvas.width * 0.4) { // rotation\n            e.getDelta(v2_2);\n            this._eulerP.y -= v2_2.x * this.rotateSpeed * 0.1;\n            this._eulerP.x += v2_2.y * this.rotateSpeed * 0.1;\n        } else { // position\n            e.getDelta(v2_2);\n            this._eulerP.y -= v2_2.x * this.rotateSpeed * 0.1;\n            this._eulerP.x += v2_2.y * this.rotateSpeed * 0.1;\n        }\n    }\n\n    public onTouchEnd (e: EventTouch) {\n        if (document.exitPointerLock) { document.exitPointerLock(); }\n        e.getStartLocation(v2_1);\n        if (v2_1.x < game.canvas.width * 0.4) { // position\n            this._velocity.x = 0;\n            this._velocity.z = 0;\n        }\n    }\n\n    private keys = [];\n    // x  -1 left, +1 right   y -1 backword, +1 forward\n    private moveDir:Vec3 = new Vec3();\n    onKeyDown(event:EventKeyboard){\n        console.log('EventKeyboard:',EventKeyboard)\n        let keyCode = event.keyCode;\n        if(keyCode == KeyCode.KEY_A || keyCode == KeyCode.KEY_S || keyCode == KeyCode.KEY_D || keyCode == KeyCode.KEY_W){\n            if(this.keys.indexOf(keyCode) == -1){\n                this.keys.push(keyCode);\n                this.updateDirection();\n            }\n        }\n        if(keyCode == KeyCode.KEY_Q){\n            this.moveDir.y = -1;\n        }\n        else if(keyCode == KeyCode.KEY_E){\n            this.moveDir.y = 1;\n        }\n    }\n\n    onKeyUp(event:EventKeyboard){\n        let keyCode = event.keyCode;\n        if(keyCode == KeyCode.KEY_A || keyCode == KeyCode.KEY_S || keyCode == KeyCode.KEY_D || keyCode == KeyCode.KEY_W){\n            let index = this.keys.indexOf(keyCode);\n            if(index != -1){\n                this.keys.splice(index,1);\n                this.updateDirection();\n            }\n        }\n\n        if(keyCode == KeyCode.KEY_Q || keyCode == KeyCode.KEY_E){\n            this.moveDir.y = 0;\n        }\n    }\n\n    private key2dirMap = null;\n\n    updateDirection(){\n        if(this.key2dirMap == null){\n            this.key2dirMap = {};\n            this.key2dirMap[0] = v2(0,0);\n            this.key2dirMap[KeyCode.KEY_A] = v2(-1,0);\n            this.key2dirMap[KeyCode.KEY_D] = v2(1,0);\n            this.key2dirMap[KeyCode.KEY_W] = v2(0,1);\n            this.key2dirMap[KeyCode.KEY_S] = v2(0,-1);\n\n            this.key2dirMap[KeyCode.KEY_A * 1000 + KeyCode.KEY_W] = this.key2dirMap[KeyCode.KEY_W * 1000 + KeyCode.KEY_A] = v2(-1,1);\n            this.key2dirMap[KeyCode.KEY_D * 1000 + KeyCode.KEY_W] = this.key2dirMap[KeyCode.KEY_W * 1000 + KeyCode.KEY_D] = v2(1,1);\n            this.key2dirMap[KeyCode.KEY_A * 1000 + KeyCode.KEY_S] = this.key2dirMap[KeyCode.KEY_S * 1000 + KeyCode.KEY_A] = v2(-1,-1);\n            this.key2dirMap[KeyCode.KEY_D * 1000 + KeyCode.KEY_S] = this.key2dirMap[KeyCode.KEY_S * 1000 + KeyCode.KEY_D] = v2(1,-1);\n\n            this.key2dirMap[KeyCode.KEY_A * 1000 + KeyCode.KEY_D] = this.key2dirMap[KeyCode.KEY_D];\n            this.key2dirMap[KeyCode.KEY_D * 1000 + KeyCode.KEY_A] = this.key2dirMap[KeyCode.KEY_A];\n            this.key2dirMap[KeyCode.KEY_W * 1000 + KeyCode.KEY_S] = this.key2dirMap[KeyCode.KEY_S];\n            this.key2dirMap[KeyCode.KEY_S * 1000 + KeyCode.KEY_W] = this.key2dirMap[KeyCode.KEY_W];\n        }\n        let keyCode0 = this.keys[this.keys.length - 1] || 0;\n        let keyCode1 = this.keys[this.keys.length - 2] || 0;\n        let dir = this.key2dirMap[keyCode1 * 1000 + keyCode0];\n        this.moveDir.x = dir.x;\n        this.moveDir.z = dir.y;\n    }\n}\n"]}